<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href=../src/css/initial.css rel=stylesheet type="text/css">
    <link href=../src/css/reset.css rel=stylesheet type="text/css">
    <link href=../src/css/colors.css rel=stylesheet type="text/css">
    <link href=../src/css/fonts.css rel=stylesheet type="text/css">
    <link href=../src/css/variables.css rel=stylesheet type="text/css">
    <script async rel=preload as="script" type="text/javascript" src="../src/es/helpers/Environment.js?msrcVersion=20230117142619"></script>
    <script async rel=preload as="script" type="text/javascript" src="../wc-config.js"></script>
    <title>Tool Book - Iframe</title>
  </head>
  <body>
    <c-fetch-html no-storage>
      <c-fetch-css no-storage>
        <c-fetch-modules>
          <p-general>
            <o-body>
              <main></main>
            </o-body>
          </p-general>
        </c-fetch-modules>
      </c-fetch-css>
    </c-fetch-html>
    <script>
      self.addEventListener('message', event => {
        let main = document.body.querySelector('main')
        if (!main) main = document.body.querySelector('o-body').main
        main.innerHTML = event.data.example.innerHTML
        // custom element define
        const notDefined = Array.from(document.body.querySelector('main').querySelectorAll(':not(:defined)')).filter(node => !customElements.get(node.tagName.toLowerCase()))
        // get all preset attributes from our target components
        let counter = -1
        event.data.attributes = notDefined.reduce((acc, node) => {
          if (node.tagName.includes(event.data.example.parentNameKebab.toUpperCase())) {
            event.data.example.tagName = node.tagName
            counter++
            return Array.from(node.attributes).reduce((acc, attribute) => ({...acc, [attribute.name]: { values: Array.from(new Set([...(acc[attribute.name]?.values || []), attribute.value || ''])).filter(attr => attr), has: [...(acc[attribute.name]?.has || []), counter]}}), acc)
          }
          return acc
        }, event.data.attributes)
        console.log('***event.data******', event.data)
        // TODO: Render the attribute checkboxes for each event.data.example.parentNameKebab component
        if (notDefined?.length) {
          if (document.body.hasAttribute(/*this.getAttribute('load-custom-elements') || */'load-custom-elements')) {
            this.dispatchEvent(new CustomEvent(/*this.getAttribute('load-custom-elements') || */'load-custom-elements', {
              detail: {
                nodes: notDefined
              },
              bubbles: true,
              cancelable: true,
              composed: true
            }))
          } else {
            console.error(
              'There are :not(:defined) web components in the template. You must load through wc-config or manually:',
              notDefined,
              this
            )
          }
        }
      })
    </script>
    <style>
      body {
        --background-color: #eee;
        background-color: var(--background-color);
      }
    </style>
  </body>
</html>