<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href=../src/css/initial.css rel=stylesheet type="text/css">
    <link href=../src/css/reset.css rel=stylesheet type="text/css">
    <link href=../src/css/colors.css rel=stylesheet type="text/css">
    <link href=../src/css/fonts.css rel=stylesheet type="text/css">
    <link href=../src/css/variables.css rel=stylesheet type="text/css">
    <script async rel=preload as="script" type="text/javascript" src="../src/es/helpers/Environment.js?msrcVersion=20230117142619"></script>
    <script async rel=preload as="script" type="text/javascript" src="../wc-config.js"></script>
    <title>Tool Book - Iframe</title>
  </head>
  <body>
    <section></section>
    <script>
      self.addEventListener('message', event => {
        document.body.querySelector('section').innerHTML = event.data.innerHTML
        // custom element define
        const notDefined = Array.from(document.body.querySelector('section').querySelectorAll(':not(:defined)')).filter(node => !customElements.get(node.tagName.toLowerCase()))
        // TODO: read all attributes before customElements define:
        console.log('*********', notDefined.reduce((acc, node) => ({...acc, [node.tagName]: { attributes: Array.from(node.attributes) }}), {}))
        if (notDefined?.length) {
          if (document.body.hasAttribute(/*this.getAttribute('load-custom-elements') || */'load-custom-elements')) {
            this.dispatchEvent(new CustomEvent(/*this.getAttribute('load-custom-elements') || */'load-custom-elements', {
              detail: {
                nodes: notDefined
              },
              bubbles: true,
              cancelable: true,
              composed: true
            }))
          } else {
            console.error(
              'There are :not(:defined) web components in the template. You must load through wc-config or manually:',
              notDefined,
              this
            )
          }
        }
      })
    </script>
  </body>
</html>